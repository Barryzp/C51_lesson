C51 COMPILER V9.54   DS1302                                                                02/21/2026 15:47:12 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\ds1302.obj
COMPILER INVOKED BY: F:\program_files\C51V5\C51\BIN\C51.EXE ds1302.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\ds1302.lst) TABS(2) OBJECT(.\Objects\ds1302.obj)

line level    source

   1          #include "ds1302.h"
   2          
   3          // å…¨å±€å˜é‡å®šä¹‰
   4          unsigned char date_time[] = {26, 2, 21, 15, 13, 55, 6}; // å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼Œæ˜ŸæœŸä¸è®¾ç½®
   5          
   6          void DS1302_Init(){
   7   1        DS1302_CE = 0;
   8   1        DS1302_SCLK = 0;
   9   1      }
  10          
  11          void DS1302_Write_Byte(unsigned char command, unsigned char byte){
  12   1      
  13   1        // è¿˜æ˜¯ä¸€æ­¥ä¸€æ­¥æ¥ä»‹ç»åœ°è¿›è¡Œæ¼”ç¤ºï¼Œæœ€åå†åˆå¹¶æˆä¸ºä¸€ä¸ªå¾ªç¯
  14   1        unsigned char i;
  15   1        DS1302_CE = 1;
  16   1      
  17   1        // DS1302å†™å…¥å‘½ä»¤å­—å’Œæ•°æ®å­—éƒ½æ˜¯ä½ä½å…ˆå†™å…¥
  18   1        for(i = 0; i < 8; i++){
  19   2          DS1302_IO = command&(0x01<<i); // æˆ–è€…(0x01 << i) & command
  20   2          DS1302_SCLK = 1;
  21   2          DS1302_SCLK = 0;
  22   2        }
  23   1        for(i = 0; i < 8; i++){
  24   2          DS1302_IO = byte&(0x01<<i); // æˆ–è€…(0x01 << i) & byte
  25   2          DS1302_SCLK = 1;
  26   2          DS1302_SCLK = 0;
  27   2        }
  28   1        DS1302_CE = 0;
  29   1      }
  30          
  31          unsigned char DS1302_Read_Byte(unsigned char command){
  32   1        unsigned char i;
  33   1        unsigned char byte = 0x00;
  34   1      
  35   1        command |= 0x01; // è¯»å‘½ä»¤çš„æœ€ä½ä½æ˜¯1ï¼Œå†™å‘½ä»¤çš„æœ€ä½ä½æ˜¯0ï¼Œæ‰€ä»¥ç›´æ¥æŠŠæœ€ä½ä½ç½®1å
             -°±å¥½äº†
  36   1      
  37   1        DS1302_CE = 1;
  38   1      
  39   1        // DS1302å†™å…¥å‘½ä»¤å­—å’Œæ•°æ®å­—éƒ½æ˜¯ä½ä½å…ˆå†™å…¥
  40   1        for(i = 0; i < 8; i++){
  41   2          DS1302_IO = command&(0x01<<i); // æˆ–è€…(0x01 << i) & command
  42   2          DS1302_SCLK = 0;
  43   2          DS1302_SCLK = 1;
  44   2        }
  45   1      
  46   1        // è¯»å–çš„æ—¶å€™æ³¢å½¢ä¼šå°‘ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯»å–å®Œå‘½ä»¤å­—åå°±ä¼šç›´æ¥è¯»å–æ•°æ®å­—äº†ï¼Œæ‰€
             -ä»¥é”å­˜çš„ä¸Šå‡æ²¿å’Œä¸‹é™æ²¿çš„é¡ºåºåäº†ä¸€ä¸‹
  47   1        for(i = 0; i < 8; i++){
  48   2          DS1302_SCLK = 1;
  49   2          DS1302_SCLK = 0;
  50   2          if (DS1302_IO)
  51   2          {
  52   3            byte |= (0x01 << i);
C51 COMPILER V9.54   DS1302                                                                02/21/2026 15:47:12 PAGE 2   

  53   3          }
  54   2        }
  55   1        DS1302_CE = 0;
  56   1        DS1302_IO = 0; // è¯»å–å®Œæ•°æ®åæŠŠIOå£æ‹‰ä½ï¼Œé˜²æ­¢å¯¹DS1302é€ æˆå¹²æ‰°
  57   1        return byte;
  58   1      }
  59          
  60          void DS1302_Set_Time(){
  61   1          DS1302_Write_Byte(DS1302_CONTROL_REG, 0x00); // å…³é—­å†™ä¿æŠ¤
  62   1          DS1302_Write_Byte(DS1302_YEAR_REG, date_time[0] / 10 * 16 + date_time[0] % 10); // å¹´
  63   1          DS1302_Write_Byte(DS1302_MONTH_REG, date_time[1] / 10 * 16 + date_time[1] % 10); // æœˆ
  64   1          DS1302_Write_Byte(DS1302_DATE_REG, date_time[2] / 10 * 16 + date_time[2] % 10); // æ—¥
  65   1          DS1302_Write_Byte(DS1302_HOURS_REG, date_time[3] / 10 * 16 + date_time[3] % 10); // æ—¶
  66   1          DS1302_Write_Byte(DS1302_MINUTES_REG, date_time[4] / 10 * 16 + date_time[4] % 10); // åˆ†
  67   1          DS1302_Write_Byte(DS1302_SECONDS_REG, date_time[5] / 10 * 16 + date_time[5] % 10); // ç§’
  68   1          DS1302_Write_Byte(DS1302_DAY_REG, date_time[6]); // æ˜ŸæœŸ
  69   1          DS1302_Write_Byte(DS1302_CONTROL_REG, 0x80); // å¼€å¯å†™ä¿æŠ¤
  70   1      }
  71          
  72          unsigned char BCD2DEC(unsigned char bcd){
  73   1          return bcd / 16 * 10 + bcd % 16;
  74   1      }
  75          
  76          void DS1302_Get_Time(){
  77   1          date_time[0] = BCD2DEC(DS1302_Read_Byte(DS1302_YEAR_REG));
  78   1          date_time[1] = BCD2DEC(DS1302_Read_Byte(DS1302_MONTH_REG));
  79   1          date_time[2] = BCD2DEC(DS1302_Read_Byte(DS1302_DATE_REG));
  80   1          date_time[3] = BCD2DEC(DS1302_Read_Byte(DS1302_HOURS_REG));
  81   1          date_time[4] = BCD2DEC(DS1302_Read_Byte(DS1302_MINUTES_REG));
  82   1          date_time[5] = BCD2DEC(DS1302_Read_Byte(DS1302_SECONDS_REG));
  83   1          date_time[6] = DS1302_Read_Byte(DS1302_DAY_REG);
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    412    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
